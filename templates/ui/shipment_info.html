
{% extends "ui/base.html" %}
{% block content %}

<div class="app-shell">
  <header class="app-header">
    <div class="app-header__left">
      <div class="brand">
        <div class="brand__logo"><i class="bi bi-grid-1x2-fill"></i></div>
        <div class="brand__text">
          <div class="brand__name">Operations Suite</div>
          <div class="brand__sub">Suivi • Documents • Collaboration</div>
        </div>
      </div>
      <div class="header-divider d-none d-md-block"></div>
      <div class="header-meta d-none d-lg-flex">
        <div class="meta-pill">
          <i class="bi bi-person-circle"></i>
          <span class="fw-bold">{{ request.user.username }}</span>
        </div>
        <span class="status-pill"><span class="dot"></span> Connecté</span>
      </div>
    </div>
    <div class="app-header__right">
      <a href="javascript:history.back()" class="btn btn-sm btn-ghost">Retour</a>
      <a href="#chat" class="btn btn-sm btn-primary btn-pill">Chat</a>
    </div>
  </header>

  <main class="app-main">
    <div class="container py-4">
      <div class="row g-4">
        <div class="col-lg-8">
          <section class="card app-card mb-4">
            <div class="card-body">
               <div class="d-flex gap-3 mb-3">
                  <div class="icon-tile"><i class="bi bi-box-seam"></i></div>
                  <div>
                     <h5 class="mb-0 fw-bold">Conteneur {{ shipment.container_no }}</h5>
                     <span class="badge badge-soft-primary">{{ shipment.status }}</span>
                  </div>
               </div>
               <div class="grid-2">
                  <div class="info-box">
                     <div class="info-box__label">Expéditeur</div>
                     <div class="info-box__value">{{ shipment.client_name }}</div>
                  </div>
                  <div class="info-box">
                     <div class="info-box__label">Destination</div>
                     <div class="info-box__value">{{ shipment.destination_site }}</div>
                  </div>
               </div>
            </div>
          </section>

          <section class="card app-card">
            <div class="card-header bg-transparent border-bottom border-secondary">
               <h6 class="mb-0 fw-bold"><i class="bi bi-file-earmark-text me-2"></i>Documents</h6>
            </div>
            <div class="table-responsive">
              <table class="table table-dark table-hover mb-0 app-table">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th class="text-center">Version</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for d in documents %}
                  <tr>
                    <td><span class="fw-bold">{{ d.doc_type }}</span></td>
                    <td class="text-center"><span class="badge bg-dark">v{{ d.version }}</span></td>
                    <td class="text-end">
                      <a href="{{ d.file.url }}" class="btn btn-sm btn-outline-light me-1">Voir</a>
                      <button class="btn btn-sm btn-primary">Partager</button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div class="col-lg-4">
           <section class="card app-card">
              <div class="card-header bg-transparent border-bottom border-secondary">
                 <h6 class="mb-0 fw-bold">Historique</h6>
              </div>
              <div class="card-body">
                 <div class="timeline">
                    {% for update in shipment.updates.all %}
                    <div class="timeline-item">
                       <div class="timeline-dot"></div>
                       <div class="small fw-bold">{{ update.status }}</div>
                       <div class="text-muted small">{{ update.created_at|date:"H:i" }}</div>
                    </div>
                    {% endfor %}
                 </div>
              </div>
           </section>
        </div>
      </div>

      <section id="chat" class="mt-5">
         <div class="card app-card chat-card">
            <div id="chat-box" class="chat-box" style="height: 400px; overflow-y: auto;">
               </div>
            <div class="chat-inputbar">
               <form class="d-flex gap-2">
                  <input type="text" class="form-control bg-dark text-white border-secondary" placeholder="Message...">
                  <button class="btn btn-primary">Envoyer</button>
               </form>
            </div>
         </div>
      </section>
    </div>
  </main>
</div>

<style>
  :root {
    --bg-dark: #070b14;
    --card-bg: #0f172a;
    --accent: #4f8cff;
    --border: rgba(255,255,255,0.1);
  }

  body { background-color: var(--bg-dark) !important; color: #e2e8f0; }

  .app-shell { min-height: 100vh; padding-top: 80px; }

  .app-header {
    position: fixed; top: 0; width: 100%; height: 70px;
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 2rem; z-index: 1000;
  }

  .app-card {
    background: var(--card-bg) !important;
    border: 1px solid var(--border) !important;
    border-radius: 12px;
  }

  .icon-tile {
    width: 45px; height: 45px; background: rgba(79, 140, 255, 0.2);
    border-radius: 10px; display: flex; align-items: center; justify-content: center;
    color: var(--accent); font-size: 1.2rem;
  }

  .info-box {
    background: rgba(255,255,255,0.03);
    padding: 15px; border-radius: 10px; border: 1px solid var(--border);
  }

  .info-box__label { font-size: 0.7rem; text-transform: uppercase; color: #94a3b8; }
  .info-box__value { font-weight: bold; color: #f8fafc; }

  .app-table { background: transparent !important; }
  .app-table thead th { background: rgba(255,255,255,0.05) !important; border: none; color: #94a3b8; }
  .app-table td { vertical-align: middle; border-color: var(--border) !important; }

  .timeline { border-left: 2px solid var(--border); padding-left: 20px; position: relative; }
  .timeline-item { position: relative; margin-bottom: 20px; }
  .timeline-dot { 
    position: absolute; left: -26px; top: 5px; 
    width: 10px; height: 10px; background: var(--accent); border-radius: 50%; 
  }

  .badge-soft-primary { background: rgba(79, 140, 255, 0.2); color: #4f8cff; border: 1px solid rgba(79, 140, 255, 0.3); }
  
  .chat-inputbar { padding: 15px; background: rgba(0,0,0,0.2); border-top: 1px solid var(--border); }
</style>

{% endblock %}