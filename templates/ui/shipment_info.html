
<h3 id="chat" class="mt-4">Discussion</h3>
  <div class="card shadow-sm border-0" style="border-radius: 12px; background-color: #f0f2f5; margin-bottom: 50px;">
      <div id="chat-box" style="height: 450px; overflow-y: auto; padding: 20px;">
          {% for msg in chat_messages %}
              {% if msg.author == request.user %}
                  <div class="d-flex justify-content-end mb-4">
                      <div class="d-flex align-items-end" style="max-width: 80%;">
                          <div class="me-2">
                              <div class="text-end mb-1">
                                  <small class="text-muted" style="font-size: 0.7rem;">Moi • {{ msg.created_at|date:"H:i" }}</small>
                              </div>
                              <div class="p-3 shadow-sm" style="background-color: #007bff; color: white; border-radius: 18px 18px 2px 18px;">
                                  {{ msg.body }}
                              </div>
                          </div>
                          <img src="https://ui-avatars.com/api/?name={{ msg.author.username }}&background=0D6EFD&color=fff&rounded=true" 
                               alt="m" width="35" height="35" class="rounded-circle shadow-sm">
                      </div>
                  </div>
              {% else %}
                  <div class="d-flex justify-content-start mb-4">
                      <div class="d-flex align-items-end" style="max-width: 80%;">
                          <img src="https://ui-avatars.com/api/?name={{ msg.author.username }}&background=6c757d&color=fff&rounded=true" 
                               alt="d" width="35" height="35" class="rounded-circle shadow-sm">
                          
                          <div class="ms-2">
                              <div class="mb-1">
                                  <strong style="font-size: 0.8rem; margin-left: 5px;">{{ msg.author.username }}</strong> 
                                  <small class="text-muted" style="font-size: 0.7rem;">• {{ msg.created_at|date:"H:i" }}</small>
                              </div>
                              <div class="p-3 shadow-sm" style="background-color: white; color: black; border-radius: 18px 18px 18px 2px;">
                                  {{ msg.body }}
                              </div>
                          </div>
                      </div>
                  </div>
              {% endif %}
          {% empty %}
              <div class="text-center text-muted py-5">
                  <i class="bi bi-chat-dots" style="font-size: 2rem;"></i>
                  <p class="mt-2">Aucune conversation pour le moment.</p>
              </div>
          {% endfor %}
      </div>

      <div class="card-footer bg-white border-0 p-3" style="border-radius: 0 0 12px 12px;">
          <form method="post" action="{% url 'shipment_detail' shipment.id %}#chat" class="d-flex gap-2">
              {% csrf_token %}
              <input type="hidden" name="form_name" value="chat">
              <input class="form-control border-0 bg-light" type="text" name="body" placeholder="Votre message..." required style="border-radius: 25px; padding: 12px 20px;">
              <button class="btn btn-primary px-4 shadow-sm" type="submit" style="border-radius: 25px;">
                  Envoyer
              </button>
          </form>
      </div>
  </div>